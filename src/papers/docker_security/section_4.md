## Understanding the Security Risks of Docker Hub


### 链接
[Docker Hub 安全风险研究](https://www-users.cse.umn.edu/~kjlu/papers/docker.pdf)

### 简要内容概况
本文是首次对 Docker Hub 进行的大规模安全分析。Docker Hub 作为最受欢迎的 Docker 镜像仓库之一，其安全性问题一直未受到充分关注。文章通过实证分析揭示了 Docker 镜像中的多个安全关键问题，包括运行命令中的敏感参数、Docker 镜像中的执行程序以及所含软件的漏洞。研究团队收集了超过 200 万个 Docker 镜像及其相关元数据，发现了一些深刻的见解，例如敏感参数的运行命令可能给用户和主机带来灾难性的伤害，发现了 42 个恶意镜像，以及 Docker 镜像中软件漏洞修补的显著延迟或被忽视。

### 重点内容梳理

#### 安全问题
1. **敏感参数**：运行命令中的敏感参数可能破坏容器与宿主机或其他容器之间的隔离，例如，`--privileged` 参数允许容器获得宿主机的根访问权限。
2. **恶意镜像**：在 Docker Hub 上发现了 42 个恶意镜像，这些镜像能够执行远程代码执行和恶意加密货币挖掘等攻击。
3. **漏洞修补延迟**：Docker 镜像中软件的漏洞修补平均延迟了 422 天，有些情况下，单个镜像可能包含多达 7500 个未修补的漏洞。

#### 解决方案
1. **敏感参数的解决方案**：
   - 设计一个框架，自动在 Docker Hub 的仓库描述网页上识别敏感参数并警告用户。
   - 实施运行时警告，类似于 iOS 中采用的技术，以在执行带有敏感参数的运行命令前警告用户潜在的风险。

2. **恶意镜像的检测**：
   - 使用 VirusTotal 等在线恶意软件分析工具进行初步筛选，然后动态运行潜在恶意文件进行二次筛选，以确认检测结果并分析这些文件的行为。

3. **漏洞修补**：
   - 自动更新是减轻来自易受攻击镜像的安全风险的有效方式。提出使用工具如 Anchore 来获取漏洞描述信息，并使用包管理工具解决软件包之间的依赖关系，以安全地更新易受攻击的软件。

### 完整示例
1. **敏感参数攻击示例**：
   - 使用 `--volume` 或 `-v` 参数挂载宿主机卷到容器，攻击者可以上传宿主机卷中保存的用户数据到在线仓库，如 GitHub。

2. **恶意镜像检测框架**：
   - 开发的框架使用自定义解析器定位和提取 Docker 镜像中的执行程序，然后利用 VirusTotal API 检测潜在恶意文件，并在沙箱容器中自动运行和追踪这些文件以生成系统日志。

3. **漏洞修补示例**：
   - 使用 Anchore 工具检测每个镜像的漏洞，并研究 Docker 镜像中发现的漏洞的分布情况。

### 小结
本文通过对 Docker Hub 的安全风险进行深入分析，揭示了新生态系统带来的安全威胁，并提出了相应的解决方案。这对于理解 Docker Hub 的安全状况具有重要意义，并为未来的 Docker 生态系统安全改进提供了关键的推动力。研究团队已经将所有在本文中发现的安全问题报告给了 Docker Hub，并建议采取多种缓解措施。